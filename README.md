## Ανάπτυξη Λογισμικού για Πληροφοριακά Συστήματα (Κ23α)

Θεόφιλος Κανταρτζής 1115201400
Σκούρας Γιώργος 1115201400309

### Τελική Αναφορά

Στην εργασία αυτή καλούμαστε να υλοποιήσουμε τον αλγόριθμο ζεύξης πινάκων Sort Merge Join . Στόχος είναι να πραγματοποιείται ζεύξη μεταξύ δύο σχέσεων αφου πρώτα τα δεδομένα της κάθε σχέσης έχουν ταξινομηθεί. 

### Μεταγλώτιση και εκτέλεση

#### Mεταγλώτιση

 ```bash
make
```
#### Εκτέλεση

```bash
./EXEC/sort_join
```

### Περιγραφή λειτουργικότητας
 

 #### Αποθήκευεση Δεδομένων

* Διαβάζουμε το αρχείο με τις σχέσεις και το αποθηκεύουμε στη δομή all_data που είναι ένας πίνακας με δείκτες στη δομή relation_data. Κάθε relation_data έχει δείκτες στην αρχή κάθε coloumn τη σχέσης. Κάθε φορά που διαβάζουμε νέα σχέση η δομή all_data επεκτείνεται κατά 1.
Όταν ο χρήστης πατήσει "Done" τελειώνει και η ανάγνωση τον σχέσεων.

* Το αρχείο με τα Queries αποθηκεύεται στη δομή Batches η οποία κρατάει όλα τα Batches και έχει δείκτες στη δομή Batch_lines που εκεί κρατάμε κάθε query ξεχωριστά

* Οι σχέσεις, τα κατηγορήματα και οι προβολές αποθηκεύονται σε ξεχωριστές δομές (predicates, check sums) όπου έκει κρατάμε και τις πληροφορίες που χρειάζονται κάθε φορά, όπως το σε ποιά σχέση αναφερόμαστε κάθε φορά(rel_origin) και ποια είναι η αντίστοιχή της στο ερώτημα(rel_alias).

#### Εκτέλεση Ερωτημάτων

 * Αρχικά εκτελούνται τα φίλτρα των ερωτημάτων για να μειωθεί το μέγεθος των πινάκων. Τα rowid των σχέσεων που φιλτράρονται αποθηκεύονται στη δομή Between, στον πίνακα farrays
 
 * Αντίστοιχα στην ίδια δομή, κρατάμε ένα δείκτη στην δομή result_list που είναι μια λίστα που κρατάει τα ενδιάμεσα αποτελέσματα που προκύπτουν απο τις ζεύξης μεταξύ των σχέσεων. Σε κάθε κόμβο της λίστας κρατάμε τα rowids των σχέσεων που εγιναν join.
 
  ![alt test](result List.png).
 
 * Πριν γίνει κάθε join καλούμε την συνάρτηση prepare_relation() η οποία αναλαμβάνει να ταξινομήσει την εκάστοτε σχέση. Ανάλογα με το αν αυτή η σχέση έχει φιλτραριστεί ή έχει γίνει join,  επιλέγουμε θα πάρουμε τα δεδομένα της από τον αρχικό πίνακα ή απο την δομή των ενδιάμεσων αποτελεσμάτων. 
 
 * Κατα την εκτέλεση του πρώτου join σε κάθε query γεμίζουμε την λίστα με την συνάρτηση result_list_fill_empty(), ενώ αν έχει πραγματοποιηθεί ήδη κάποιο join καλούμε την συνάρτηση result_list_update() ώστε να ανανεώσουμε την λίστα με τα καινούργια αποτελέσματα.
    
 * Αν έχουν συμμετάσχει δύο σχέσεις σε κάποια ζεύξη και στη συνέχεια ξαναζητηθούν τότε η εκάστοτε ζεύξη εκτελείται ως φίλτρο. Ακόμη αν μια σχέση ζητηθεί δυό φορες τότε γίνεται τα join με εκείνη τη σχέση πρώτα για να εκμεταλευτούμε το γεγονός ότι η σχέση αυτή θα είναι ήδη ταξινομημένη.

#### Έλεγχος αθροισμάτων

* Στην συνάρτηση print_check_sums() αναλόγως τις προβολές του κάθε ερωτήματος απλά  αθροιζουμε τα payloads μόνο τον keys που περιέχονται στη λίστα. 

### Χρόνος Εκτέλεσης

Ο χρόνος εκτέλεσης για το small αρχείο είναι της τάξης των λίγων δευτερολέπτων.









